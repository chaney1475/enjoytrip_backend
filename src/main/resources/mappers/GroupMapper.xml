<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enjoytrip.group.mapper.GroupMapper">

    <resultMap id="GroupWithCreatorResult" type="com.enjoytrip.group.domain.Group">
        <id property="groupId" column="group_id"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="createdAt" column="created_at"/>
        <result property="maxParticipant" column="max_participants"/>
        <association property="creator" javaType="com.enjoytrip.user.domain.User">
            <id property="userId" column="creator_id"/>
            <result property="nickname" column="creator_name"/>
            <result property="email" column="creator_email"/>
            <result property="avatarUrl" column="creator_url"/>
        </association>
    </resultMap>

    <insert id="insertGroup" parameterType="com.enjoytrip.group.domain.Group">
        INSERT INTO `groups` (title, description, creator_id, attraction_id, created_at, max_participants)
        VALUES (#{title}, #{description}, #{creator.userId},#{attraction_id}, #{createdAt}, #{maxParticipant});
        <selectKey resultType="Long" keyProperty="groupId" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <select id="findByGroupId" parameterType="Long" resultMap="GroupWithCreatorResult">
        SELECT g.group_id, g.title, g.description, g.creator_id, g.created_at, g.max_participants,
               u.user_id AS creator_id, u.nickname AS creator_name, u.email AS creator_email, u.avatar_url AS creator_url
        FROM `groups` g
                 INNER JOIN `user` u ON g.creator_id = u.user_id
        WHERE g.group_id = #{groupId}
    </select>

    <!-- 전체 그룹 목록 조회 -->
    <select id="selectAllGroups" resultMap="GroupWithCreatorResult">
        SELECT g.group_id, g.title, g.description, g.creator_id, g.created_at, g.max_participants,
               u.user_id AS creator_id, u.nickname AS creator_name, u.email AS creator_email, u.avatar_url AS creator_url
        FROM `groups` g
                 INNER JOIN `user` u ON g.creator_id = u.user_id
    </select>



</mapper>
